<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Math Tutor Portal</title>

  <!-- Firebase v8 (IMPORTANT: v8, not v9) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    body { font-family: Arial; padding: 30px; }
    input, button { margin: 5px 0; padding: 8px; width: 250px; }
    .hidden { display: none; }
    h2 { color: #333; }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login">
    <h2>Login</h2>
    <input id="email" type="email" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="error" style="color:red;"></p>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="admin" class="hidden">
    <h2>Admin Dashboard</h2>
    <p>Welcome, Admin</p>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- STUDENT DASHBOARD -->
  <div id="student" class="hidden">
    <h2 id="welcome">Welcome</h2>
    <p>This is your student dashboard.</p>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    // ðŸ”¥ YOUR FIREBASE CONFIG (already correct)
    const firebaseConfig = {
      apiKey: "AIzaSyCLHLzJ1wm-j6i7YEf5YfBFGPcE4Qk1gQo",
      authDomain: "math-tutor-student-records.firebaseapp.com",
      projectId: "math-tutor-student-records",
      storageBucket: "math-tutor-student-records.appspot.com",
      messagingSenderId: "759946890002",
      appId: "1:759946890002:web:0fc283523c793c3eeb01cb"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const error = document.getElementById("error");

      error.innerText = "";

      auth.signInWithEmailAndPassword(email, password)
        .then(cred => {
          return db.collection("users").doc(cred.user.email).get();
        })
        .then(doc => {

          if (!doc.exists) {
            alert("No user profile found in Firestore.");
            auth.signOut();
            return;
          }

          const data = doc.data();

          document.getElementById("login").classList.add("hidden");

          if (data.role === "admin") {
            document.getElementById("admin").classList.remove("hidden");
          } else {
            document.getElementById("student").classList.remove("hidden");
            document.getElementById("welcome").innerText =
              "Welcome, " + (data.firstName || "Student");
          }
        })
        .catch(err => {
          error.innerText = err.message;
        });
    }

    function logout() {
      auth.signOut().then(() => {
        location.reload();
      });
    }
  </script>

</body>
</html>
