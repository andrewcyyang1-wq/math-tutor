<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Math Tutor App</title>
<style>
body { font-family: Arial; text-align:center; margin-top:50px; }
input, button { padding: 5px; margin:5px; }
#adminDiv, #studentDiv { display:none; }
</style>
</head>
<body>

<div id="loginDiv">
  <h2>Login</h2>
  <input id="email" type="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
</div>

<div id="adminDiv">
  <h2>Admin Dashboard</h2>
  <h3>Add Student</h3>
  <input id="newStudentEmail" placeholder="Email">
  <input id="newStudentPassword" placeholder="Password">
  <input id="newStudentFirst" placeholder="First Name">
  <input id="newStudentLast" placeholder="Last Name">
  <button id="addStudentBtn">Add Student</button>

  <h3>Manage Homework/Session</h3>
  <input id="studentSelect" placeholder="Student Email">
  <input id="homeworkInput" placeholder="Homework">
  <button id="addHomeworkBtn">Add Homework</button>
  <input id="sessionInput" placeholder="Next Session">
  <button id="addSessionBtn">Add Session</button>
</div>

<div id="studentDiv">
  <h2>Student Dashboard</h2>
  <p id="welcomeMessage"></p>
  <h3>Homework:</h3>
  <ul id="homeworkList"></ul>
  <h3>Next Session:</h3>
  <p id="nextSession"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCLHLzJ1wm-j6i7YEf5YfBFGPcE4Qk1gQo",
  authDomain: "math-tutor-student-records.firebaseapp.com",
  projectId: "math-tutor-student-records",
  storageBucket: "math-tutor-student-records.firebasestorage.app",
  messagingSenderId: "759946890002",
  appId: "1:759946890002:web:0fc283523c793c3eeb01cb",
  measurementId: "G-RXQQWNXNV0"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Elements
const loginDiv = document.getElementById('loginDiv');
const adminDiv = document.getElementById('adminDiv');
const studentDiv = document.getElementById('studentDiv');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const welcomeMessage = document.getElementById('welcomeMessage');
const homeworkList = document.getElementById('homeworkList');
const nextSessionP = document.getElementById('nextSession');

// Admin elements
const newStudentEmail = document.getElementById('newStudentEmail');
const newStudentPassword = document.getElementById('newStudentPassword');
const newStudentFirst = document.getElementById('newStudentFirst');
const newStudentLast = document.getElementById('newStudentLast');
const addStudentBtn = document.getElementById('addStudentBtn');
const studentSelect = document.getElementById('studentSelect');
const homeworkInput = document.getElementById('homeworkInput');
const addHomeworkBtn = document.getElementById('addHomeworkBtn');
const sessionInput = document.getElementById('sessionInput');
const addSessionBtn = document.getElementById('addSessionBtn');

// Login
loginBtn.addEventListener('click', () => {
  const email = emailInput.value;
  const password = passwordInput.value;
  auth.signInWithEmailAndPassword(email,password)
    .then(userCredential => {
      loginDiv.style.display='none';
      // Check role from Firestore
      db.collection('users').doc(email).get().then(doc=>{
        const role = doc.data().role;
        if(role==='admin') {
          adminDiv.style.display='block';
        } else {
          studentDiv.style.display='block';
          welcomeMessage.textContent = `Welcome, ${doc.data().firstName}`;
          // Show homework and next session
          const hw = doc.data().homework || [];
          homeworkList.innerHTML = '';
          hw.forEach(h => {
            const li = document.createElement('li'); li.textContent=h; homeworkList.appendChild(li);
          });
          nextSessionP.textContent = doc.data().nextSession || 'No session scheduled';
        }
      });
    })
    .catch(err => alert(err.message));
});

// Admin functions
addStudentBtn.addEventListener('click', ()=>{
  const email = newStudentEmail.value;
  const password = newStudentPassword.value;
  const first = newStudentFirst.value;
  const last = newStudentLast.value;
  auth.createUserWithEmailAndPassword(email,password)
    .then(user=>{
      db.collection('users').doc(email).set({
        firstName:first,
        lastName:last,
        role:'student',
        homework:[],
        nextSession:''
      });
      alert('Student added!');
    }).catch(err=>alert(err.message));
});

addHomeworkBtn.addEventListener('click', ()=>{
  const studentEmail = studentSelect.value;
  const hw = homeworkInput.value;
  db.collection('users').doc(studentEmail).update({
    homework: firebase.firestore.FieldValue.arrayUnion(hw)
  }).then(()=>alert('Homework added!'));
});

addSessionBtn.addEventListener('click', ()=>{
  const studentEmail = studentSelect.value;
  const session = sessionInput.value;
  db.collection('users').doc(studentEmail).update({nextSession:session})
    .then(()=>alert('Session updated!'));
});
</script>
</body>
</html>
